<!doctype html>
<html>
  <head>
        <meta charset="UTF-8">
    <title>Socket.IO chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; background: #fff;}
      #messages { list-style-type: none; margin: 0; padding: 0;  overflow:auto; height: 92vh; width: 100%; }
      #messages li { padding: 5px 10px; border: 0; padding: 10px; width: 100%; margin-right: .5%;}
      #messages li:nth-child(odd) { background: #eee; }

    </style>
  </head>
  <body >
    <div id = "content" >
        <ul id="messages" ></ul>
    </div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.1/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script>

    $(function () {

        var name = ''
        var socket = io('http://127.0.0.1:8001');

        socket.emit('iammanage', '');


        socket.on('allow', function (data) {
          // 往lu动态添加li
          // $('#messages').append( '<li>' + 
          //              '<div style= "border: 0; padding: 10px; width: 80%; margin-right: .5%;">' +  
          //              data + 
          //              '</div>' + 
          //              '<button id = "sure_bt" style="width: 50%; background: rgb(130, 224, 255); border: none; padding: 10px;" > sure </button>'  + 
          //              '<button id = "cancel_bt" style="width: 50%; background: rgb(255, 150, 10); border: none; padding: 10px;" > cancel </button>' + 
          //              '</li>');
          //   // 默认滚动底部
          // $('#messages').scrollTop( $('#messages')[0].scrollHeight);
          // $('#messages').on('click',"#sure_bt",function(){
          //   $(this).parent().remove(); 
          //  });
         $('#messages').append( '<li> <div usrid = "' + 
                        data.userid + 
                        '"  usercmd = "' + 
                        data.cmd + 
                        '" >' +  
                        data.title + 
                       '</div> <button id = "sure_bt" style="width: 49%; background: rgb(130, 224, 255); border: none; padding: 10px;" > sure </button> <button id = "cancel_bt" style="width: 49%; background: rgb(255, 150, 10); border: none; padding: 10px;" > cancel </button> </li>');
            // 默认滚动底部
          $('#messages').scrollTop( $('#messages')[0].scrollHeight);
           // 确认
          $('#messages #sure_bt').on('click',function(){

            send_manage_data_allow = new Object();
            send_manage_data_allow.id = $(this).parent().children('div').attr("usrid");
            send_manage_data_allow.cmd = $(this).parent().children('div').attr("usercmd")
            socket.emit('send_manage_data_allow', send_manage_data_allow);
            $(this).parent().remove();

           });
          // 取消
          $('#messages #cancel_bt').on('click',function(){

            send_manage_data_deny = new Object();
            send_manage_data_deny.id = $(this).parent().children('div').attr("usrid");
            send_manage_data_deny.cmd = $(this).parent().children('div').attr("usercmd")
            socket.emit('send_manage_data_deny', send_manage_data_deny);
            $(this).parent().remove();
            
           });
        });



         

        // connect：连接成功
        // connecting：正在连接
        // disconnect：断开连接
        // connect_failed：连接失败
        // error：错误发生，并且无法被其他事件类型所处理
        // message：同服务器端message事件
        // anything：同服务器端anything事件
        // reconnect_failed：重连失败
        // reconnect：成功重连
        // reconnecting：正在重连
        // 当第一次连接时，事件触发顺序为：connecting->connect；当失去连接时，事件触发顺序为：disconnect->reconnecting（可能进行多次）->connecting->reconnect->connect。

    
    });

  </script>
</html>
